#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
解密 createOrder 接口的请求和响应
"""
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import binascii
import json

# AES 密钥和 IV（与 sendSms 相同）
AES_KEY = "1234123412ABCDEF"
AES_IV = "ABCDEF1234123412"

# 捕获的加密请求体
encrypted_request_hex = "2C80B15FA4E970D7538E8628FE541A8FD713D8D67B8D1A3D670648CE26FD15BB9EFBA202F44938A1465410ACFB36FBFD9DBA72B7E829030E73497A029A480A163CF3D53BF2D0222D25F1C4202C86FC8795123EAFEEA9F69107CE20B27A49F72C4E96E78319F4B813BEFA43AC6C9C869445505820BC258EAF43446AFF79AA0F9C8B668B6E01667509C36581A948CA1EAC7FD92601655EFAEE67E284A25E36CB001E42A395DFBD92B71AF7B87A8CDEA946DBF4A0E941346E13598E857D713528532185B017BD2EA6649B2CCD8F2945DA92852D7C7E843E8AF848A66081743529AA31811305C2A488144A8FC664CFB4075EB003A494B15302A4683608700423BE493D96435AD273B1CEC50F5F944BB26D66FB6DFB866BBB3316FC97CD31F045E71A567E21115A10087F66DC563579F0B58E7E1A080EB499D6288BE8D44D7D5A45B7C0545735900A9E55EB981FEC5300A11530223521B6700052A073287650312188F6A698C5343B70F563231742473855A424773D6636E863A1E84A0285E2C685F7887FF2081C2A1DD0959C50095E731729A06337F3963B6CBAA74ADCA590AB45F10A0F4C18562371196571AB96D2D37E6EEA9D3775966AE65DF60778F12737D43E55FD918A0BA92046E7F6E7AF3670172E4A1FA3FD858113B04FD16D0241024E67B552D2198EC053C9580043FA90A4799C680B7EDF8B8AF6C71DFE452522D8EC076D0C3409903046ABB8096EBCC0668FE40CF2D68A919FC7B19059A5B3EAE195885EAE18F1E685BA023AE56B021454F6C0DBCDDC07C2909565A3A4B77EB658CD50A224FD650BF981333485E18CDE234097D89C70A7DD63AEBCD73429772196A4308CADA2A4729E687F557901B7D26CDD9EE89569BA5D01E89ADC03EABACC29C92638EDCD0653936CBE63DA5AD3199D36076DD3D603E3BAFD2F87DD0AF5D3A0FD99"

# 捕获的加密响应体
encrypted_response_hex = "E777BDC1F7CBC26AB231BE1B94B8BDD92741B94D6786187DBAC0261C61A016C99F645E32F7DE13B874C5ED878CED1CA885BAC8406067A655C956934E25FD0A5CBA52E0DFEB98332207713BAE2637D30A347B155E5FEFB7B2E3D3636B598B4C9B2AE94976D66ECD1217A00EAB795833A7"

def decrypt_aes_cbc(encrypted_hex, key, iv):
    """解密 AES-CBC 加密的数据"""
    encrypted_bytes = binascii.unhexlify(encrypted_hex)
    key_bytes = key.encode('utf-8')
    iv_bytes = iv.encode('utf-8')
    cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes)
    decrypted_padded = cipher.decrypt(encrypted_bytes)
    decrypted = unpad(decrypted_padded, AES.block_size)
    return decrypted.decode('utf-8')

if __name__ == "__main__":
    print("=" * 80)
    print("解密 createOrder 接口请求")
    print("=" * 80)
    
    try:
        decrypted_request = decrypt_aes_cbc(encrypted_request_hex, AES_KEY, AES_IV)
        print(f"\n解密后的请求体:")
        print(decrypted_request)
        
        request_json = json.loads(decrypted_request)
        print(f"\n解析后的JSON参数:")
        print(json.dumps(request_json, indent=2, ensure_ascii=False))
    except Exception as e:
        print(f"\n解密请求体失败: {e}")
    
    print("\n" + "=" * 80)
    print("解密 createOrder 接口响应")
    print("=" * 80)
    
    try:
        decrypted_response = decrypt_aes_cbc(encrypted_response_hex, AES_KEY, AES_IV)
        print(f"\n解密后的响应体:")
        print(decrypted_response)
        
        response_json = json.loads(decrypted_response)
        print(f"\n解析后的JSON:")
        print(json.dumps(response_json, indent=2, ensure_ascii=False))
    except Exception as e:
        print(f"\n解密响应体失败: {e}")
